<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Train the image classifier using PyTorch | Step-by-step Data Science</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#4285F4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href=".">
<link rel="icon" href="images/LogoMakr_2dGBSO.png" sizes="16x16">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-134273341-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-134273341-1');
</script><link rel="prev" href="../loading-scikit-learns-mnist-dataset/" title="Loading scikit-learn's MNIST Hand-Written Dataset" type="text/html">
<meta property="og:site_name" content="Step-by-step Data Science">
<meta property="og:title" content="Train the image classifier using PyTorch">
<meta property="og:url" content="/posts/train-the-image-classifier-using-pytorch/">
<meta property="og:description" content="Goal¶This post aims to introduce how to train the image classifier for MNIST dataset using PyTorch
Reference

PyTorch Documentation - TORCHVISION.DATASETS
PyTorch Tutorial - TRAINING A CLASSIFIER
Kagg">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-06-22T17:50:57-07:00">
<script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../">

                <span id="blog-title">Step-by-step Data Science</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../categories/coding">Coding Problems</a>
                </li>
<li>
<a href="../../categories/machine-learning">Machine Learning</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">All <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../">All Post</a>
                    </li>
<li>
<a href="../../categories/">Categories and Tags</a>
                    </li>
<li>
<a href="../../archive.html">History</a>
            </li>
</ul>
</li>
<li>
<a href="../../rss.xml">RSS</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Train the image classifier using PyTorch</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    h1ros
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-06-22T17:50:57-07:00" itemprop="datePublished" title="Jun 22, 2019, 5:50:57 PM">Jun 22, 2019, 5:50:57 PM</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/train-the-image-classifier-using-pytorch.html">Comments</a>


            

        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Goal">Goal<a class="anchor-link" href="#Goal">¶</a>
</h2>
<p>This post aims to introduce how to train the image classifier for MNIST dataset using PyTorch</p>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://pytorch.org/docs/stable/torchvision/datasets.html#mnist">PyTorch Documentation - TORCHVISION.DATASETS</a></li>
<li><a href="https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html">PyTorch Tutorial - TRAINING A CLASSIFIER</a></li>
<li><a href="https://www.kaggle.com/sdelecourt/cnn-with-pytorch-for-mnist">Kaggle kernel - CNN with Pytorch for MNIST </a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Libraries">Libraries<a class="anchor-link" href="#Libraries">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Dataset</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">load_digits</span>

<span class="c1"># PyTorch</span>
<span class="kn">import</span> <span class="nn">torch</span> 
<span class="kn">import</span> <span class="nn">torchvision</span>
<span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>

<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="c1"># unnormalize</span>
    <span class="n">npimg</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">npimg</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-MNIST-dataset">Load MNIST dataset<a class="anchor-link" href="#Load-MNIST-dataset">¶</a>
</h2>
<p>When downloading the image dataset, we also need to define <code>transform</code> function that apply pixel normalization from [0, 1] to [-1, +1]</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
    <span class="p">[</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
     <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">))])</span>

<span class="n">trainset</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">'~/data'</span><span class="p">,</span> 
                                        <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

<span class="n">testset</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">'~/data'</span><span class="p">,</span> 
                                        <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                        <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                        <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>
9920512it [00:28, 1582029.76it/s]                             

1654784it [00:23, 573182.07it/s]                             </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-a-dataloader">Create a dataloader<a class="anchor-link" href="#Create-a-dataloader">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">trainset</span><span class="p">,</span>
                                          <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                          <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">testloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">testset</span><span class="p">,</span>
                                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-a-model">Define a model<a class="anchor-link" href="#Define-a-model">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 28x28x32 -&gt; 26x26x32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 26x26x64 -&gt; 24x24x64</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># 24x24x64 -&gt; 12x12x64</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout2d</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout2d</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-a-loss-function-and-optimizer">Create a loss function and optimizer<a class="anchor-link" href="#Create-a-loss-function-and-optimizer">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-a-model">Training a model<a class="anchor-link" href="#Training-a-model">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainloader</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># zero the parameter gradients</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># forward + backward + optimize</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># print statistics</span>
        <span class="n">running_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">'[{epoch + 1}, {i+1}] loss: {running_loss / 100:.2}'</span><span class="p">)</span>
            <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'Finished Training'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1, 100] loss: 1.5
[1, 200] loss: 0.82
[1, 300] loss: 0.63
[1, 400] loss: 0.55
[1, 500] loss: 0.5
[1, 600] loss: 0.46
[2, 100] loss: 0.42
[2, 200] loss: 0.4
[2, 300] loss: 0.38
[2, 400] loss: 0.38
[2, 500] loss: 0.34
[2, 600] loss: 0.34
[3, 100] loss: 0.31
[3, 200] loss: 0.31
[3, 300] loss: 0.29
[3, 400] loss: 0.28
[3, 500] loss: 0.28
[3, 600] loss: 0.26
[4, 100] loss: 0.24
[4, 200] loss: 0.24
[4, 300] loss: 0.24
[4, 400] loss: 0.23
[4, 500] loss: 0.23
[4, 600] loss: 0.22
[5, 100] loss: 0.2
[5, 200] loss: 0.21
[5, 300] loss: 0.2
[5, 400] loss: 0.19
[5, 500] loss: 0.19
[5, 600] loss: 0.19
Finished Training
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test">Test<a class="anchor-link" href="#Test">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataiter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">testloader</span><span class="p">)</span>
<span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">dataiter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_test</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Ground Truth'</span><span class="p">:</span> <span class="n">labels</span><span class="p">[:</span><span class="n">n_test</span><span class="p">],</span>
    <span class="s1">'Predicted label'</span><span class="p">:</span> <span class="n">predicted</span><span class="p">[:</span><span class="n">n_test</span><span class="p">]})</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_result</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">torchvision</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">make_grid</span><span class="p">(</span><span class="n">images</span><span class="p">[:</span><span class="n">n_test</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">nrow</span><span class="o">=</span><span class="n">n_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr></thead>
<tbody>
<tr>
<th>Ground Truth</th>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>4</td>
      <td>9</td>
      <td>5</td>
      <td>9</td>
    </tr>
<tr>
<th>Predicted label</th>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>4</td>
      <td>9</td>
      <td>6</td>
      <td>9</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../loading-scikit-learns-mnist-dataset/" rel="prev" title="Loading scikit-learn's MNIST Hand-Written Dataset">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-h1ros-github-io",
            disqus_url="/posts/train-the-image-classifier-using-pytorch/",
        disqus_title="Train the image classifier using PyTorch",
        disqus_identifier="cache/posts/train-the-image-classifier-using-pytorch.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><script>var disqus_shortname="https-h1ros-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:data.h1ros@gmail.com">h1ros</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'h1ros-github-io/ama'
  };
</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(1, "YYYY-MM-DD");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><!-- GitHub Buttons --><script async defer src="https://buttons.github.io/buttons.js"></script><!-- Twitter Widgets --><script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);
  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };
  return t;
}(document, "script", "twitter-wjs"));</script>
</body>
</html>
